import streamlit as st
import random

def get_new_recommendation(category):
    available_choices = [key for key, value in data.items() if value["카테고리"] == category and key not in st.session_state.buffer]
    if not available_choices:
        available_choices = [key for key, value in data.items() if value["카테고리"] == category]
    return random.choice(available_choices)

def update_recommendation():
    if st.session_state.category == "랜덤":
        available_choices = [key for key in data.keys() if key not in st.session_state.buffer]
        if not available_choices:
            available_choices = list(data.keys())
        st.session_state.recommendation = random.choice(available_choices)
    else:
        st.session_state.recommendation = get_new_recommendation(st.session_state.category)
    
    st.session_state.description = data[st.session_state.recommendation]["설명"]


data = {
    "김치찌개": {"카테고리": "한식", "설명": "뜨끈한 국물에 밥 말아 먹으면 최고! 🥄"},
    "비빔밥": {"카테고리": "한식", "설명": "신선한 야채와 고소한 고추장 소스의 조화! 🍚"},
    "불고기": {"카테고리": "한식", "설명": "달콤 짭짤한 양념에 부드러운 고기 한 점! 🥩"},
    "된장찌개": {"카테고리": "한식", "설명": "구수한 된장 국물에 두부와 야채가 듬뿍! 🍲"},
    "제육볶음": {"카테고리": "한식", "설명": "매콤 달달한 제육을 상추에 싸서 한입! 🥬"},
    "갈비탕": {"카테고리": "한식", "설명": "진한 국물과 부드러운 갈비살이 일품! 🍖"},
    "닭갈비": {"카테고리": "한식", "설명": "매콤한 양념이 배어든 쫄깃한 닭고기! 🍗"},
    "삼겹살": {"카테고리": "한식", "설명": "바삭하게 구운 삼겹살, 상추에 싸먹으면 최고! 🥓"},
    "보쌈": {"카테고리": "한식", "설명": "부드러운 돼지고기와 아삭한 김치의 조화! 🍖"},
    "감자탕": {"카테고리": "한식", "설명": "얼큰한 국물과 부드러운 돼지등뼈가 일품! 🍲"},
    "해장국": {"카테고리": "한식", "설명": "해장에 좋은 깊은 맛의 국물 요리! 🍜"},
    "떡국": {"카테고리": "한식", "설명": "쫄깃한 떡과 깊은 국물의 조화! 🍲"},
    "콩나물국밥": {"카테고리": "한식", "설명": "담백하고 개운한 국물의 숙취 해소 국밥! 🍲"},
    "닭한마리": {"카테고리": "한식", "설명": "진한 닭 육수에 삶아진 닭고기와 칼국수의 만남! 🍲"},
    "곰탕": {"카테고리": "한식", "설명": "오랜 시간 고아낸 깊고 진한 국물의 국밥! 🍜"},
    "육개장": {"카테고리": "한식", "설명": "얼큰하고 개운한 쇠고기 국물 요리! 🔥"},
    "청국장": {"카테고리": "한식", "설명": "구수한 청국장과 밥 한 공기의 조화! 🍲"},
    "장어구이": {"카테고리": "한식", "설명": "기력 회복에 좋은 고소한 장어구이! 🐟"},
    "쌈밥": {"카테고리": "한식", "설명": "각종 나물과 고기를 쌈에 싸먹는 건강식! 🥬"},
    "순두부찌개": {"카테고리": "한식", "설명": "부드러운 순두부와 얼큰한 국물의 조화! 🌶️"},
    "스시": {"카테고리": "일식", "설명": "신선한 회와 고슬고슬한 초밥의 만남! 🍣"},
    "돈카츠": {"카테고리": "일식", "설명": "겉은 바삭, 속은 촉촉한 일본식 돈카츠! 🐷"},
    "우동": {"카테고리": "일식", "설명": "쫄깃한 면발과 깊은 육수의 조화! 🍜"},
    "라멘": {"카테고리": "일식", "설명": "진한 국물과 부드러운 차슈가 일품! 🍜"},
    "연어덮밥": {"카테고리": "일식", "설명": "고소한 연어와 신선한 채소가 조화로운 덮밥! 🍣"},
    "가츠동": {"카테고리": "일식", "설명": "달달한 소스와 함께 즐기는 바삭한 돈카츠 덮밥! 🥢"},
    "규동": {"카테고리": "일식", "설명": "짭짤한 소고기와 부드러운 계란의 조화! 🍚"},
    "텐동": {"카테고리": "일식", "설명": "바삭한 튀김을 간장소스에 찍어먹는 덮밥! 🍤"},
    "사케동": {"카테고리": "일식", "설명": "연어와 고소한 간장 양념이 어우러진 덮밥! 🐟"},
    "파스타": {"카테고리": "양식", "설명": "크림, 토마토, 오일 다양한 소스의 매력! 🍝"},
    "스테이크": {"카테고리": "양식", "설명": "육즙 가득한 고기를 즐기는 최고의 선택! 🥩"},
    "피자": {"카테고리": "양식", "설명": "치즈가 듬뿍, 바삭한 도우가 매력적인 요리! 🍕"},
    "햄버거": {"카테고리": "양식", "설명": "부드러운 번과 육즙 가득한 패티의 만남! 🍔"},
    "크림스프": {"카테고리": "양식", "설명": "부드럽고 고소한 맛이 일품인 스프! 🥣"},
    "짜장면": {"카테고리": "중식", "설명": "달달한 짜장 소스에 쫄깃한 면발이 환상의 조합! 🍜"},
    "짬뽕": {"카테고리": "중식", "설명": "얼큰하고 시원한 국물의 짬뽕! 🔥"},
    "마라탕": {"카테고리": "중식", "설명": "매콤 얼얼한 국물에 원하는 재료를 추가해서 즐기자! 🌶🔥"},
    "꿔바로우": {"카테고리": "중식", "설명": "새콤달콤 바삭한 중국식 탕수육! 🍖"},
    "딤섬": {"카테고리": "중식", "설명": "다양한 소로 채워진 중국식 만두! 🥟"},
    "마파두부": {"카테고리": "중식", "설명": "얼얼한 향신료가 매력적인 두부 요리! 🌶️"},
    "탕수육": {"카테고리": "중식", "설명": "달콤하고 바삭한 튀김 요리! 🍖"},
    "떡볶이": {"카테고리": "분식", "설명": "매콤달콤한 소스에 쫄깃한 떡! 🍢"},
    "순대": {"카테고리": "분식", "설명": "부드러운 순대와 매콤한 양념이 잘 어울리는 조합! 🌶️"},
    "김밥": {"카테고리": "분식", "설명": "다양한 속 재료가 들어간 한입 간편식! 🍙"},
    "오뎅": {"카테고리": "분식", "설명": "따끈한 국물과 쫄깃한 어묵! 🍢"},
    "튀김": {"카테고리": "분식", "설명": "바삭한 튀김과 떡볶이는 환상의 조합! 🍤"},
    "볶음밥": {"카테고리": "중식", "설명": "각종 재료가 어우러진 맛있는 볶음밥! 🍛"},
    "라볶이": {"카테고리": "분식", "설명": "떡볶이에 라면이 더해져 든든한 맛! 🍜"},
    "핫도그": {"카테고리": "분식", "설명": "달콤한 설탕과 바삭한 핫도그의 조화! 🌭"},
    "쫄면": {"카테고리": "분식", "설명": "새콤달콤한 양념과 쫄깃한 면발의 만남! 🍜"},
    "잔치국수": {"카테고리": "분식", "설명": "따뜻하고 담백한 국수 요리! 🍜"},
    "김치전": {"카테고리": "분식", "설명": "바삭하고 매콤한 김치 부침개! 🍕"},
    "양념치킨": {"카테고리": "분식", "설명": "달콤 매콤한 소스가 어우러진 치킨! 🍗"},
    "타코야끼": {"카테고리": "일식", "설명": "바삭하고 부드러운 반죽 속에 문어가 쏙! 🐙"},
    "오코노미야끼": {"카테고리": "일식", "설명": "일본식 부침개로 고소한 맛이 일품! 🥞"},
    "야끼소바": {"카테고리": "일식", "설명": "볶음면과 달달한 소스의 환상적인 조합! 🍜"},
    "장어덮밥": {"카테고리": "일식", "설명": "고소한 장어와 부드러운 밥이 어우러진 요리! 🐟"},
    "회덮밥": {"카테고리": "일식", "설명": "신선한 회와 초고추장이 조화를 이루는 한 끼! 🍣"},
    "나베": {"카테고리": "일식", "설명": "따뜻하고 깊은 국물 맛의 일본식 전골 요리! 🍲"},
    "스키야키": {"카테고리": "일식", "설명": "달콤한 간장 소스에 익혀 먹는 일본식 전골! 🥩"},
    "사시미": {"카테고리": "일식", "설명": "신선한 생선을 그대로 즐기는 일본식 요리! 🍣"},
    "초밥": {"카테고리": "일식", "설명": "숙성된 밥과 다양한 재료가 어우러진 대표 일식! 🍣"},
    "멘타이코": {"카테고리": "일식", "설명": "매콤하고 짭짤한 명란이 매력적인 일본 요리! 🐟"},
    "야키토리": {"카테고리": "일식", "설명": "불맛이 살아있는 일본식 닭꼬치 요리! 🍢"},
    "그라탕": {"카테고리": "양식", "설명": "치즈와 크림이 어우러진 따뜻한 오븐 요리! 🧀"},
    "리조또": {"카테고리": "양식", "설명": "부드럽고 고소한 이탈리아식 밥 요리! 🍛"},
    "샌드위치": {"카테고리": "양식", "설명": "다양한 재료를 활용한 간편한 한 끼! 🥪"},
    "토마호크": {"카테고리": "양식", "설명": "압도적인 크기의 고기를 구워 먹는 스테이크! 🥩"},
    "랍스터": {"카테고리": "양식", "설명": "고급스러운 해산물 요리의 대명사! 🦞"},
    "까르보나라": {"카테고리": "양식", "설명": "진한 크림과 베이컨이 조화를 이루는 파스타! 🍝"},
    "봉골레": {"카테고리": "양식", "설명": "신선한 조개와 올리브 오일이 어우러진 파스타! 🍝"},
    "라자냐": {"카테고리": "양식", "설명": "층층이 쌓인 소스와 치즈가 매력적인 이탈리아 요리! 🧀"},
    "프렌치토스트": {"카테고리": "양식", "설명": "달콤하고 부드러운 아침 식사의 대표 메뉴! 🍞"},
    "포크찹": {"카테고리": "양식", "설명": "육즙이 살아있는 돼지고기 스테이크! 🥩"},
    "칠리크랩": {"카테고리": "양식", "설명": "매콤달콤한 소스가 일품인 해산물 요리! 🦀"},
    "그릭요거트": {"카테고리": "양식", "설명": "건강한 단백질과 신선한 과일의 조화! 🍓"},
    "치즈플래터": {"카테고리": "양식", "설명": "다양한 치즈와 과일, 견과류가 함께하는 안주 요리! 🧀"},
    "파니니": {"카테고리": "양식", "설명": "노릇하게 구운 이탈리아식 샌드위치! 🥪"},
    "클럽샌드위치": {"카테고리": "양식", "설명": "고기와 채소가 층층이 쌓인 풍성한 샌드위치! 🥪"},
    "깐풍기": {"카테고리": "중식", "설명": "바삭한 닭튀김에 매콤달콤한 소스가 더해진 요리! 🍗"},
    "칠리새우": {"카테고리": "중식", "설명": "매콤달콤한 칠리소스와 바삭한 새우튀김의 조화! 🍤"},
    "유린기": {"카테고리": "중식", "설명": "바삭한 닭튀김에 새콤한 소스를 더한 요리! 🍗"},
    "양장피": {"카테고리": "중식", "설명": "쫄깃한 면과 다양한 재료가 어우러진 중식 샐러드! 🥗"},
    "동파육": {"카테고리": "중식", "설명": "부드럽게 조리된 돼지고기와 진한 소스가 특징! 🍖"},
    "고추잡채": {"카테고리": "중식", "설명": "매콤한 피망과 부드러운 고기가 어우러진 중식 요리! 🌶️"},
    "해물누룽지탕": {"카테고리": "중식", "설명": "바삭한 누룽지와 해산물이 어우러진 깊은 국물 요리! 🍲"},
    "북경오리": {"카테고리": "중식", "설명": "겉은 바삭, 속은 촉촉한 오리요리의 최고봉! 🦆"},
    "산라탕": {"카테고리": "중식", "설명": "새콤하면서도 얼큰한 중국식 국물 요리! 🍜"},
    "팔보채": {"카테고리": "중식", "설명": "해산물과 채소가 어우러진 화려한 중국 요리! 🍛"},
    "깐쇼새우": {"카테고리": "중식", "설명": "새콤달콤한 소스가 어우러진 바삭한 새우 요리! 🍤"},
    "홍쇼우육": {"카테고리": "중식", "설명": "부드럽고 진한 풍미가 느껴지는 중식 돼지고기 요리! 🍖"},
    "치즈떡볶이": {"카테고리": "분식", "설명": "쭉 늘어나는 치즈와 매콤한 떡볶이의 환상 조합! 🧀"},
    "비빔국수": {"카테고리": "분식", "설명": "새콤달콤한 양념장과 쫄깃한 면발이 만나는 별미! 🍜"},
    "주먹밥": {"카테고리": "분식", "설명": "한입에 쏙 들어가는 간편하고 맛있는 밥 요리! 🍙"},
    "돈가스김밥": {"카테고리": "분식", "설명": "바삭한 돈가스와 김밥의 만남! 🥢"},
    "매운떡볶이": {"카테고리": "분식", "설명": "얼얼하게 매운 맛이 특징인 중독성 강한 떡볶이! 🌶️"},
    "잔치국수": {"카테고리": "분식", "설명": "담백한 멸치 육수에 얇은 면발이 조화로운 국수 요리! 🍜"},
    "유부초밥": {"카테고리": "분식", "설명": "달콤한 유부 속에 부드러운 밥이 가득! 🍙"},
    "로제떡볶이": {"카테고리": "분식", "설명": "크림소스와 매콤한 떡볶이가 어우러진 인기 메뉴! 🌶️🧀"},
    "김치전": {"카테고리": "한식", "설명": "바삭하고 매콤한 김치와 반죽의 조화! 🍕"},
    "부추전": {"카테고리": "한식", "설명": "고소한 부추와 바삭한 반죽이 어우러진 전! 🥞"},
    "해물파전": {"카테고리": "한식", "설명": "쫄깃한 해물과 향긋한 파가 조화로운 바삭한 전! 🥢"},
    "감자전": {"카테고리": "한식", "설명": "바삭하게 부친 감자전, 담백한 맛이 일품! 🥞"}
}

if "recommendation" not in st.session_state:
    st.session_state.recommendation = None
if "buffer" not in st.session_state:
    st.session_state.buffer = []
if "final_choice" not in st.session_state:
    st.session_state.final_choice = None
if "category" not in st.session_state:
    st.session_state.category = "랜덤"

st.title("🍽 저점메추 스트림릿")
categories = list(set(item["카테고리"] for item in data.values()))
st.session_state.category = st.selectbox("원하는 카테고리를 선택하세요!", categories + ["랜덤"])

if st.button("🍽 저점메추! 추천 받기"):
    update_recommendation()

if st.session_state.recommendation:
    st.subheader(f"오늘의 추천: {st.session_state.recommendation}")
    st.write(st.session_state.description)
    col1, col2, col3 = st.columns(3)
    with col1:
        if st.button("✅ 선택"):
            st.session_state.final_choice = st.session_state.recommendation
    with col2:
        if st.button("⏳ 보류"):
            if st.session_state.recommendation not in st.session_state.buffer:
                st.session_state.buffer.append(st.session_state.recommendation)
            update_recommendation()
            st.rerun()
    with col3:
        if st.button("❌ 별로"):
            update_recommendation()
            st.rerun()

if st.session_state.final_choice:
    st.success(f"최종 선택: {st.session_state.final_choice} 🍽")
    st.write(f"📍 근처 식당 추천: [지도 보기](https://www.google.com/maps/search/{st.session_state.final_choice})")

st.subheader("⏳ 현재 보류 목록")
selected_buffer_items = st.multiselect("보류된 메뉴에서 선택", st.session_state.buffer, default=st.session_state.buffer)
if st.button("이 메뉴로 결정! ✅") and selected_buffer_items:
    st.session_state.final_choice = selected_buffer_items[0]
    st.session_state.buffer = []
    st.rerun()

if st.button("🔄 리셋"):
    st.session_state.recommendation = None
    st.session_state.buffer = []
    st.session_state.final_choice = None
    st.session_state.category = "랜덤"
    st.rerun()
